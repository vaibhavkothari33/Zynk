"use strict";!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.websdk=t():e.websdk=t()}(this,(function(){return(this.webpackChunkwebsdk=this.webpackChunkwebsdk||[]).push([[564],{7479:function(e,t,r){r.r(t),r.d(t,{acceptContactInvite:function(){return L},acceptInvitation:function(){return z},addContact:function(){return x},addReaction:function(){return V},addToBlackList:function(){return J},addUsersToBlacklist:function(){return q},addUsersToBlocklist:function(){return H},declineContactInvite:function(){return G},declineInvitation:function(){return X},deleteContact:function(){return B},deleteConversation:function(){return b},deleteReaction:function(){return Y},deleteSession:function(){return A},fetchHistoryMessages:function(){return P},fetchUserInfoById:function(){return R},getBlacklist:function(){return v},getBlocklist:function(){return T},getChatToken:function(){return O},getContacts:function(){return E},getConversationlist:function(){return C},getHistoryMessages:function(){return Z},getReactionDetail:function(){return te},getReactionList:function(){return $},getReactionlist:function(){return ee},getRoster:function(){return S},getServerConversations:function(){return ne},getServerPinnedConversations:function(){return se},getSessionList:function(){return _},modifyMessage:function(){return Q},pinConversation:function(){return ie},recallMessage:function(){return W},removeFromBlackList:function(){return K},removeHistoryMessages:function(){return ae},removeRoster:function(){return M},removeUserFromBlackList:function(){return D},removeUserFromBlocklist:function(){return F},reportMessage:function(){return re},updateCurrentUserNick:function(){return w},updateOwnUserInfo:function(){return j},updateUserInfo:function(){return N},uploadPushToken:function(){return k},uploadToken:function(){return I}}),r(9601),r(1539),r(8674),r(2526),r(1817),r(2165),r(6992),r(8783),r(3948),r(9554),r(4747),r(2222),r(7941),r(6699),r(3710),r(9714),r(9600),r(5069),r(561),r(9753),r(8309);var a=r(3246),n=r(5531),o=r(7252),s=r(4370),i=r(8161),c=r(4968),u=r(4188),l=r.n(u),p=r(7360),d=r(1595),h=r(4363),f=function(){return f=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},f.apply(this,arguments)},g=function(e,t,r,a){return new(r||(r=Promise))((function(n,o){function s(e){try{c(a.next(e))}catch(e){o(e)}}function i(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}c((a=a.apply(e,t||[])).next())}))},m=function(e,t){var r,a,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,a=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],a=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},y={chat:"singleChat",chatroom:"chatRoom",groupchat:"groupChat",singleChat:"singleChat",chatRoom:"chatRoom",groupChat:"groupChat"};function v(e){if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l={url:this.apiUrl+"/"+i+"/"+c+"/users/"+this.user+"/blocks/users",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+u},success:function(t){var r={};t.data.forEach((function(e){r[e]={name:e}})),"function"==typeof(null==e?void 0:e.success)&&e.success(t)},error:function(t){"function"==typeof(null==e?void 0:e.error)&&e.error(t)}};return p.kg.debug("Call getBlocklist"),s.hj.call(this,l,d.fI.GET_BLACK_LIST)}var T=v,S=E;function E(e){var t=this;if(!a.XZ.call(this)){var r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(r)}var i=this.context,c=i.orgName,u=i.appName,l=i.accessToken,h={url:this.apiUrl+"/"+c+"/"+u+"/users/"+this.user+"/contacts/users",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+l},success:function(r){var a=[];r.data.forEach((function(e){a.push({name:e,subscription:"both",jid:t.context.jid})})),"function"==typeof(null==e?void 0:e.success)&&e.success(a)},error:function(t){"function"==typeof(null==e?void 0:e.error)&&e.error(t)}};return p.kg.debug("Call getContacts"),s.hj.call(this,h,d.fI.GET_CONTACTS)}function I(e){if("string"!=typeof e.deviceId||""===e.deviceId)throw Error('Invalid parameter: "deviceId"');if("string"!=typeof e.deviceToken||""===e.deviceToken)throw Error('Invalid parameter: "deviceToken"');if("string"!=typeof e.notifierName||""===e.notifierName)throw Error('Invalid parameter: "notifierName"');if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/users/").concat(this.user),type:"PUT",data:JSON.stringify({device_id:e.deviceId,device_token:e.deviceToken,notifier_name:e.notifierName}),dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"},success:e.success,error:e.error};return p.kg.debug("Call uploadPushToken",e),s.hj.call(this,l,d.fI.UPLOAD_PUSH_TOKEN)}var k=I;function _(e){if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/users/").concat(this.user,"/user_channels"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"},success:e&&(null==e?void 0:e.success),error:e&&(null==e?void 0:e.error)};return p.kg.debug("Call getSessionList"),s.hj.call(this,l,d.fI.GET_SESSION_LIST)}function C(e){if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=!!(e&&"number"==typeof e.pageNum&&"number"==typeof e.pageSize&&e.pageNum>0&&e.pageSize>0),f={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/users/").concat(this.user,"/user_channels").concat(l?"/page":""),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"},success:e&&(null==e?void 0:e.success),error:e&&(null==e?void 0:e.error)};return l&&(f.data={pageNum:e.pageNum,pageSize:e.pageSize}),p.kg.debug("Call getConversationlist"),s.hj.call(this,f,d.fI.GET_SESSION_LIST).then((function(e){return function(e){var t=e.data.channel_infos;return null==t||t.forEach((function(e){e.meta&&"{}"!==JSON.stringify(e.meta)?(e.meta.payload=JSON.parse(e.meta.payload),e.lastMessage=(0,h.w)(e.meta)):e.lastMessage=e.meta,delete e.meta})),e}(e)}))}function A(e){if(e&&"string"!=typeof e.channel)throw Error("Invalid parameter channel: ".concat(e.channel));if(e&&"singleChat"!==e.chatType&&"groupChat"!==e.chatType)throw Error("Invalid parameter chatType: ".concat(e.chatType));if(e&&"boolean"!=typeof e.deleteRoam)throw Error("Invalid parameter deleteRoam: ".concat(e.deleteRoam));if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r,i=this.context,c=i.orgName,u=i.appName,l=i.accessToken,h=i.jid;r="singleChat"===e.chatType?"chat":"groupChat";var f={url:"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/user/").concat(this.user,"/user_channel?resource=").concat(h.clientResource),dataType:"json",type:"DELETE",data:JSON.stringify({channel:e.channel,type:r,delete_roam:e.deleteRoam}),headers:{Authorization:"Bearer "+l,"Content-Type":"application/json"},success:e.success,error:e.error};return p.kg.debug("Call deleteSession",e),s.hj.call(this,f,d.fI.DELETE_SESSION)}var b=A;function j(e,t){if(!a.XZ.call(this)){var r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(r)}var i=this.context,c=i.orgName,u=i.appName,l=i.accessToken,h=["nickname","avatarurl","mail","phone","gender","sign","birth","ext"],f={};if("undefined"!=typeof wx||"undefined"!=typeof qq)if("string"==typeof e&&void 0!==t){if(!h.includes(e))throw new Error("illegal key, only these keys: nickname, avatarurl, mail, phone, gender, sign, birth, ext are allowed");f[e]=t}else{if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("illegal params");h.forEach((function(t){h.includes(t)&&void 0!==e[t]&&(f[t]=e[t])}))}else if("string"==typeof e){if(!h.includes(e))throw new Error("illegal key, only these keys: nickname, avatarurl, mail, phone, gender, sign, birth, ext are allowed");f=e+"="+t}else{if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("illegal params");var g=[];h.forEach((function(t){if(h.includes(t)&&void 0!==e[t]){var r=encodeURIComponent(t),a=encodeURIComponent(e[t]);g.push(r+"="+a)}})),f=g.join("&")}var m={url:"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/metadata/user/").concat(this.user),type:"PUT",data:f,dataType:"json",headers:{Authorization:"Bearer "+l,"Content-Type":"application/x-www-form-urlencoded"}};return p.kg.debug("Call updateOwnUserInfo",e),s.hj.call(this,m,d.fI.UPDATE_USER_INFO)}var N=j;function R(e,t){if(!a.XZ.call(this)){var r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(r)}var i,c=this.context,u=c.orgName,l=c.appName,h=c.accessToken,f=[];if("string"==typeof e)f=[e];else{if("[object Array]"!==Object.prototype.toString.call(e))throw new Error("illegal params");f=e}i="string"==typeof t?[t]:t&&"[object Array]"===Object.prototype.toString.call(t)?t:["nickname","avatarurl","mail","phone","gender","sign","birth","ext"];var g={url:"".concat(this.apiUrl,"/").concat(u,"/").concat(l,"/metadata/user/get"),type:"POST",data:JSON.stringify({targets:f,properties:i}),dataType:"json",headers:{Authorization:"Bearer "+h,"Content-Type":"application/json"}};return p.kg.debug("Call fetchUserInfoById",e),s.hj.call(this,g,d.fI.GET_USER_INFO)}function w(e){if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/users/").concat(this.user),type:"PUT",dataType:"json",data:JSON.stringify({nickname:e}),headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}};return p.kg.debug("Call updateCurrentUserNick",e),s.hj.call(this,l)}function O(e){if("string"!=typeof e||""===e)throw Error('Invalid parameter: "agoraToken"');var t=this.context,r=t.orgName,a=t.appName,n={url:this.apiUrl+"/"+r+"/"+a+"/token",dataType:"json",type:"POST",data:JSON.stringify({grant_type:"agora"}),headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}};return p.kg.debug("Call getChatToken",e),s.hj.call(this,n,d.fI.SDK_INTERNAL)}function P(e){var t=this;return new Promise((function(r,s){if(!e.queue)throw Error('Invalid parameter: "specified"');if(!a.XZ.call(t)){var i=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(i)}(function e(t){var a=this,n=t.count||20;U.call(this,{count:n,isGroup:!!t.isGroup,queue:t.queue,start:t.start,format:t.format,success:function(o){if(o.msgs.length>=n||o.is_last){var s=o.msgs.splice(0,n).reverse();t.success&&t.success(s),r(s)}else e.call(a,f(f({},t),{start:null}))},fail:function(e){s(e),t.fail&&t.fail(e)}})}).call(t,e),p.kg.debug("Call fetchHistoryMessages",e)}))}function U(e){var t=this,r=e.queue,a=this.mr_cache[r]||(this.mr_cache[r]={msgs:[]}),c=this.context.userId,u=e.start||-1,p=e.count||20;if(a.msgs.length>=p||a.is_last)"function"==typeof e.success&&e.success(a);else{a&&a.next_key&&(u=a.next_key),e.start&&(u=e.start);var h={queue:r+(e.isGroup?"@conference.easemob.com":"@easemob.com"),start:u,end:-1},f=this.context,g=f.orgName,m=f.appName,y={url:"".concat(this.apiUrl,"/").concat(g,"/").concat(m,"/users/").concat(c,"/messageroaming"),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"},data:JSON.stringify(h),success:function(r){var n=null==r?void 0:r.data;if(!r.data.msgs)return"function"==typeof e.success&&e.success(a),a.is_last=!0,void(a.next_key="");var o=n.msgs,s=o.length;a.is_last=n.is_last,a.next_key=n.next_key;for(var c=function(r){for(var a=[],n=0,o=(r=l().atob(r)).length;n<o;++n)a.push(r.charCodeAt(n));var s=t.context.root.lookup("easemob.pb.Meta");if(1===(s=s.decode(a)).ns)return i.Z.call(t,s,{errorCode:0,reason:""},!0,e.format)},u=0;u<s;u++){var p=c(o[u].msg);p&&a.msgs.push(p)}"function"==typeof e.success&&e.success(a)},error:function(e){if(e.error&&e.error_description){var r=o.Z.create({type:n.E.WEBIM_CONNCTION_AJAX_ERROR,message:"fetch history messages error",data:e});t.onError&&t.onError(r)}}};s.hj.call(this,y,d.fI.GET_HISTORY_MSG).catch((function(t){"function"==typeof e.fail&&e.fail(t)}))}}function Z(e){var t=this;return new Promise((function(r,c){var u=e.targetId,d=e.cursor,h=void 0===d?-1:d,f=e.pageSize,g=void 0===f?20:f,m=e.chatType,y=e.searchDirection,v=e.searchOptions,T=void 0===v?{}:v,S=T.msgTypes,E=void 0===S?[]:S,I=T.startTime,k=void 0===I?null:I,_=T.endTime,C=void 0===_?null:_,A=T.from,b=void 0===A?null:A;if("string"!=typeof u||""===u)throw Error('"Invalid parameter": "targetId"');if(b&&"string"!=typeof b)throw Error('"Invalid parameter": "searchOptions.from"');if(E&&!Array.isArray(E))throw Error('"Invalid parameter": "searchOptions.msgTypes"');if(k&&"number"!=typeof k)throw Error('"Invalid parameter": "searchOptions.startTime"');if(C&&"number"!=typeof k)throw Error('"Invalid parameter": "searchOptions.endTime"');if(!a.XZ.call(t)){var j=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return c(j)}var N=t.context,R=N.orgName,w=N.appName,O=N.userId,P="groupChat"===e.chatType?"@conference.easemob.com":"@easemob.com",U={queue:"".concat(u).concat(P),start:h,pull_number:g,is_positive:"down"===y,msgType:E.join(",")||"",end:-1,startTime:k,endTime:C,userId:"singleChat"===m?null:b},Z={url:"".concat(t.apiUrl,"/").concat(R,"/").concat(w,"/users/").concat(O,"/messageroaming"),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+t.token,"Content-Type":"application/json"},data:JSON.stringify(U),success:function(a){for(var n,o=null==a?void 0:a.data,s=o.msgs||[],c=function(e){for(var r=[],a=0,n=(e=l().atob(e)).length;a<n;++a)r.push(e.charCodeAt(a));var o=t.context.root.lookup("easemob.pb.Meta");if(1===(o=o.decode(r)).ns)return i.Z.call(t,o,{errorCode:0,reason:""},!0,!0)},u=[],p=0;p<s.length;p++){var d=c(s[p].msg);d&&u.push(d)}o.msgs=u;var h={cursor:o.next_key,messages:u,isLast:o.is_last};null===(n=e.success)||void 0===n||n.call(e,h),r(h)},error:e.fail};s.hj.call(t,Z).catch((function(e){c(e)})),p.kg.debug("Call getHistoryMessages",e)}))}function x(e,t){var r=this;return new Promise((function(a,n){var o={id:r.getUniqueId(),to:e,message:t};c.Z.operatRoster.call(r,o,"add",a,n),p.kg.debug("Call addContact",o)}))}var M=B;function B(e){var t=this;return new Promise((function(r,a){var n={id:t.getUniqueId(),to:e};c.Z.operatRoster.call(t,n,"remove",r,a),p.kg.debug("Call deleteContact",n)}))}function z(e){var t=this;return new Promise((function(r,a){var n={id:t.getUniqueId(),to:e};c.Z.operatRoster.call(t,n,"accept",r,a),p.kg.debug("Call acceptInvitation",n)}))}var L=z;function X(e){var t=this;return new Promise((function(r,a){var n={id:t.getUniqueId(),to:e};c.Z.operatRoster.call(t,n,"decline",r,a),p.kg.debug("Call declineContactInvite",n)}))}var G=X;function J(e){var t=this;return new Promise((function(r,a){c.Z.operatRoster.call(t,{to:e.name},"ban",r,a),p.kg.debug("Call addUsersToBlocklist",e)}))}var q=J,H=J;function K(e){var t=this;return new Promise((function(r,a){c.Z.operatRoster.call(t,{to:e.name},"allow",r,a),p.kg.debug("Call removeUserFromBlocklist",e)}))}var D=K,F=K;function W(e){var t=this.getUniqueId(),r={id:t,to:e.to};this._msgHash[t]=f({},r);var a="";void 0!==e.chatType?a=e.chatType:void 0!==e.type&&(a="chat"===e.type?"singleChat":e.type);var n={id:t,type:"recall",chatType:a,ackId:e.mid,to:e.to,isChatThread:e.isChatThread||!1,success:e.success,fail:e.fail};return p.kg.debug("Call recallMessage",e),this.mSync.send(n,this)}function Q(e){var t=e||{},r=t.messageId,a=t.modifiedMessage;if(p.kg.debug("Call modifyMessage",r,a),""===r)throw Error('Invalid parameter: "messageId"');if("txt"!==a.type)throw Error('Invalid parameter: "modifiedMessage.type"');return this.mSync.send(f({editMessageId:r},a))}function V(e){return g(this,void 0,void 0,(function(){var t,r,i,c,u,l,p,d,h;return m(this,(function(f){switch(f.label){case 0:if("string"!=typeof e.messageId||!e.messageId)throw Error("Invalid parameter messageId: ".concat(e.messageId));if("string"!=typeof e.reaction||!e.reaction)throw Error("Invalid parameter reaction: ".concat(e.reaction));return a.XZ.call(this)?(r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=e.reaction,p=e.messageId,d={msgId:p,message:l},h={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/reaction/user/").concat(this.user),type:"POST",data:JSON.stringify(d),dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}},[4,s.hj.call(this,h)]):(t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)]);case 1:return f.sent(),[2]}}))}))}function Y(e){return g(this,void 0,void 0,(function(){var t,r,i,c,u,l,p,d;return m(this,(function(h){switch(h.label){case 0:if("string"!=typeof e.reaction||!e.reaction)throw Error("Invalid parameter reactionId: ".concat(e.reaction));return a.XZ.call(this)?(r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=e.messageId,p=e.reaction,d={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/reaction/user/").concat(this.user,"?msgId=").concat(l,"&message=").concat(p),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}},[4,s.hj.call(this,d)]):(t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)]);case 1:return h.sent(),[2]}}))}))}function $(e){if("string"!=typeof e.chatType||!e.chatType)throw Error("Invalid parameter chatType: ".concat(e.chatType));if(!e.messageId)throw Error("Invalid parameter messageId: ".concat(e.messageId));if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=e.chatType,p=e.messageId,d={msgIdList:"string"==typeof p?[p]:p,msgType:"singleChat"===l?"chat":"groupchat",groupId:e.groupId||null},h={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/reaction/user/").concat(this.user),type:"GET",data:d,dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}};return s.hj.call(this,h).then((function(e){var t=e.data;return null==t||t.forEach((function(e){null==e||e.reactionList.forEach((function(e){e.isAddedBySelf=e.state,delete e.state,delete e.reactionId}))})),e}))}var ee=$;function te(e){if("string"!=typeof e.reaction||!e.reaction)throw Error("Invalid parameter reaction: ".concat(e.reaction));if("string"!=typeof e.messageId||!e.messageId)throw Error("Invalid parameter messageId: ".concat(e.messageId));if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=e.cursor,p=e.pageSize,d={msgId:e.messageId,message:e.reaction,currentPage:l||null,pageSize:p||20},h={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/reaction/user/").concat(this.user,"/detail"),type:"GET",data:d,dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}};return s.hj.call(this,h).then((function(e){return e.data.isAddedBySelf=e.data.state,delete e.data.state,delete e.data.reactionId,e}))}function re(e){return g(this,void 0,void 0,(function(){var t,r,i,c,u,l,p,d,h,f,g;return m(this,(function(m){switch(m.label){case 0:if("string"!=typeof e.reportType||!e.reportType)throw Error("Invalid parameter reportType: ".concat(e.reportType));if("string"!=typeof e.messageId||!e.messageId)throw Error("Invalid parameter messageId: ".concat(e.messageId));if("string"!=typeof e.reportReason||!e.reportReason)throw Error("Invalid parameter messageId: ".concat(e.reportReason));return a.XZ.call(this)?(r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l=e.reportType,p=e.reportReason,d=e.messageId,h={username:this.user,reportType:l,reportReason:p},f="".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/user/").concat(this.user,"/moderation/report/message/").concat(d),g={url:f,type:"POST",data:JSON.stringify(h),dataType:"json",headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}},[4,s.hj.call(this,g)]):(t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)]);case 1:return m.sent(),[2]}}))}))}function ae(e){var t;return g(this,void 0,void 0,(function(){var r,i,c,u,l,d,h,f,g;return m(this,(function(m){switch(m.label){case 0:if("string"!=typeof e.targetId||""===e.targetId)throw Error('"Invalid parameter targetId": '+e.targetId);if(!["singleChat","groupChat"].includes(e.chatType))throw Error('"Invalid parameter chatType": '+e.chatType);if(e.beforeTimeStamp&&("number"!=typeof e.beforeTimeStamp||e.beforeTimeStamp<0||(null===(t=e.beforeTimeStamp)||void 0===t?void 0:t.toString().length)>18))throw Error('"Invalid parameter beforeTimeStamp": '+e.beforeTimeStamp);if(e.messageIds&&!(Array.isArray(e.messageIds)&&e.messageIds.length>0&&e.messageIds.length<=20))throw Error('"Invalid parameter messageIds": '+e.messageIds);if(!e.messageIds&&!e.beforeTimeStamp)throw Error("messageIds or beforeTimeStamp field is required.");return a.XZ.call(this)?(i=this.context,c=i.orgName,u=i.appName,l=i.userId,d="singleChat"===e.chatType?"userId":"groupId",h="singleChat"===e.chatType?"chat":"group",f=e.messageIds?"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/sdk/message/roaming/").concat(h,"/user/").concat(l,"?").concat(d,"=").concat(e.targetId,"&msgIdList=").concat(e.messageIds,"&resource=").concat(this.clientResource):"".concat(this.apiUrl,"/").concat(c,"/").concat(u,"/sdk/message/roaming/").concat(h,"/user/").concat(l,"/time?").concat(d,"=").concat(e.targetId,"&delTime=").concat(e.beforeTimeStamp,"&&resource=").concat(this.clientResource),g={url:f,dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}},p.kg.debug("Call removeHistoryMessages",e),[4,s.hj.call(this,g)]):(r=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(r)]);case 1:return m.sent(),[2]}}))}))}function ne(e){if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}if((null==e?void 0:e.pageSize)&&"number"!=typeof e.pageSize)throw Error("Invalid parameter pageSize: ".concat(e.pageSize));if((null==e?void 0:e.cursor)&&"string"!=typeof e.cursor)throw Error("Invalid parameter cursor: ".concat(e.cursor));var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/sdk/user/").concat(this.user,"/user_channels/list?"),type:"GET",dataType:"json",data:{limit:(null==e?void 0:e.pageSize)||20,cursor:(null==e?void 0:e.cursor)||""},headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}};return p.kg.debug("Call getServerConversations",e),s.hj.call(this,l,d.fI.GET_SESSION_LIST).then((function(e){return oe(e)}))}function oe(e){var t=e.data,r=t.cursor,a=t.channel_infos,n=[];null==a||a.forEach((function(e){var t=null;(null==e?void 0:e.meta)&&"{}"!==JSON.stringify(e.meta)&&(e.meta.payload=JSON.parse(e.meta.payload),"delivery"!==(t=(0,h.w)(e.meta)).type&&"read"!==t.type&&"channel"!==t.type&&(t.chatType=y[t.chatType]));var r={conversationId:e.session_to,conversationType:"chat"===e.session_type?"singleChat":"groupChat",isPinned:e.is_top,pinnedTime:e.is_top?e.update_top_status_time:0,unReadCount:e.unread_num,lastMessage:t};n.push(r)}));var o={conversations:n,cursor:r||""};return{type:e.type,data:o}}function se(e){if(!a.XZ.call(this)){var t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(t)}if((null==e?void 0:e.pageSize)&&"number"!=typeof e.pageSize)throw Error("Invalid parameter pageSize: ".concat(e.pageSize));if((null==e?void 0:e.cursor)&&"string"!=typeof e.cursor)throw Error("Invalid parameter cursor: ".concat(e.cursor));var r=this.context,i=r.orgName,c=r.appName,u=r.accessToken,l={url:"".concat(this.apiUrl,"/").concat(i,"/").concat(c,"/sdk/user/").concat(this.user,"/user_channels/list?"),type:"GET",dataType:"json",data:{limit:(null==e?void 0:e.pageSize)||20,cursor:(null==e?void 0:e.cursor)||"",is_top:!0},headers:{Authorization:"Bearer "+u,"Content-Type":"application/json"}};return p.kg.debug("Call getServerConversations",e),s.hj.call(this,l,d.fI.GET_SESSION_LIST).then((function(e){return oe(e)}))}function ie(e){return g(this,void 0,void 0,(function(){var t,r,i,c,u,l,h,f,g,y,v,T,S,E;return m(this,(function(m){if(!a.XZ.call(this))return t=o.Z.create({type:n.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(t)];if(r=e.conversationId,i=e.conversationType,c=e.isPinned,u="singleChat"===i?"chat":"groupChat","string"!=typeof r||""===r)throw Error("Invalid parameter conversationId: ".concat(r));if(!["singleChat","groupChat"].includes(i))throw Error("Invalid parameter conversationType: ".concat(i));if("boolean"!=typeof c)throw Error("Invalid parameter isPinned: ".concat(c));return l=this.context,h=l.orgName,f=l.appName,g=l.accessToken,y=l.jid,v={type:u,to:r},T=c?"":"type=".concat(u,"&to=").concat(r,"&"),S="".concat(this.apiUrl,"/").concat(h,"/").concat(f,"/sdk/user/").concat(this.user,"/user_channel/top?").concat(T,"resource=").concat(y.clientResource),E={url:S,type:c?"POST":"DELETE",dataType:"json",headers:{Authorization:"Bearer "+g,"Content-Type":"application/json"}},c&&(E.data=JSON.stringify(v)),p.kg.debug("Call pinConversation",e),[2,s.hj.call(this,E,d.fI.PIN_CONVERSATION).then((function(e){var t=e.type,r=e.data;return{type:t,data:{isPinned:r.is_top||!1,pinnedTime:r.is_top?r.update_top_status_time:0}}}))]}))}))}},3246:function(e,t,r){r.d(t,{H7:function(){return u},XZ:function(){return i},_W:function(){return c}}),r(7941),r(9554),r(1539),r(4747),r(6699),r(2023);var a=r(5531),n=r(7252);function o(){var e=this.context.appName,t=this.context.orgName;return!(!e||!t)||(this.onError&&this.onError({type:a.E.WEBIM_CONNCTION_AUTH_ERROR,message:"appName or orgName is illegal"}),!1)}function s(){var e;if(!this.context.accessToken){var t=n.Z.create({type:a.E.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR,message:"token not assign error"});return this.onError&&this.onError(t),null===(e=this.eventHandler)||void 0===e||e.dispatch("onError",t),!1}return!0}function i(){return s.call(this)&&o.call(this)}function c(e){var t=e.data,r=e.type;return{data:{status:Object.keys(t.errorKeys).length>0?"fail":"success",errorKeys:t.errorKeys,successKeys:t.successKeys},type:r}}function u(e){var t=e.data,r=void 0;return Object.keys(t.errorKeys).length>0&&Object.keys(t.errorKeys).forEach((function(e){var o=t.errorKeys[e];r=o.includes("is not part of you")?n.Z.create({type:a.E.NO_PERMISSION,message:o}):o.includes("size of metadata for this single chatroom exceeds the user defined limit")||o.includes("total size of chatroom metadata for this app exceeds the user defined limit")||o.includes("is exceeding maximum limit")?n.Z.create({type:a.E.MAX_LIMIT,message:o}):o.includes("is not Legal")?n.Z.create({type:a.E.REQUEST_PARAMETER_ERROR,message:o}):o.includes("Failed to update userMetadata. Concurrent updates not allowed")?n.Z.create({type:a.E.OPERATION_NOT_ALLOWED,message:o}):n.Z.create({type:a.E.WEBIM_CONNCTION_AJAX_ERROR,message:o})})),r}},5069:function(e,t,r){var a=r(2109),n=r(1702),o=r(3157),s=n([].reverse),i=[1,2];a({target:"Array",proto:!0,forced:String(i)===String(i.reverse())},{reverse:function(){return o(this)&&(this.length=this.length),s(this)}})}},function(e){return 7479,e(e.s=7479)}])}));